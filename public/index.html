<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Big C Drone - Slava Ukraini!</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  background: #0a0a1a;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100vh;
  font-family: 'Courier New', monospace;
  overflow: hidden;
  touch-action: none;
}
canvas {
  border: 2px solid #ffd700;
  image-rendering: pixelated;
  max-width: 100vw;
  max-height: 80vh;
}
#ui {
  color: #ffd700;
  text-align: center;
  padding: 8px;
  font-size: 14px;
}
#start-screen {
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,10,0.95);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  color: #ffd700;
  z-index: 10;
}
#start-screen h1 {
  font-size: 36px;
  margin-bottom: 8px;
  text-shadow: 0 0 20px #005bbb, 0 0 40px #ffd700;
}
#start-screen h2 {
  font-size: 18px;
  color: #005bbb;
  margin-bottom: 30px;
}
#start-screen .flag {
  font-size: 48px;
  margin-bottom: 20px;
}
#start-screen .instructions {
  font-size: 14px;
  color: #aaa;
  line-height: 1.8;
  margin-bottom: 30px;
}
#start-screen button {
  background: #005bbb;
  color: #ffd700;
  border: 2px solid #ffd700;
  padding: 12px 40px;
  font-size: 20px;
  font-family: 'Courier New', monospace;
  cursor: pointer;
  text-transform: uppercase;
  letter-spacing: 2px;
}
#start-screen button:hover {
  background: #ffd700;
  color: #005bbb;
}
#game-over {
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,10,0.95);
  display: none;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  color: #ffd700;
  z-index: 10;
}
#game-over h1 { font-size: 32px; margin-bottom: 10px; }
#game-over .score { font-size: 24px; color: #005bbb; margin-bottom: 20px; }
#game-over button {
  background: #005bbb;
  color: #ffd700;
  border: 2px solid #ffd700;
  padding: 12px 40px;
  font-size: 18px;
  font-family: 'Courier New', monospace;
  cursor: pointer;
}
.mobile-controls {
  display: none;
  position: fixed;
  bottom: 10px;
  left: 0; right: 0;
  justify-content: space-between;
  padding: 0 20px;
  z-index: 5;
}
.dpad {
  display: grid;
  grid-template-columns: 50px 50px 50px;
  grid-template-rows: 50px 50px 50px;
  gap: 2px;
}
.dpad button {
  background: rgba(255,215,0,0.3);
  border: 1px solid #ffd700;
  color: #ffd700;
  font-size: 20px;
  border-radius: 4px;
}
.fire-btn {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  background: rgba(255,0,0,0.4);
  border: 2px solid #ff4444;
  color: #ff4444;
  font-size: 14px;
  font-family: 'Courier New', monospace;
  align-self: center;
}
@media (max-width: 768px) {
  .mobile-controls { display: flex; }
  #start-screen h1 { font-size: 24px; }
}
</style>
</head>
<body>

<div id="start-screen">
  <div class="flag">ðŸ‡ºðŸ‡¦</div>
  <h1>BIG C DRONE</h1>
  <h2>SLAVA UKRAINI EDITION</h2>
  <div class="instructions">
    WASD / Piltangenter = Styr drÃ¶naren<br>
    MELLANSLAG = Skjut<br>
    Jaga Putin. Undvik missiler.<br>
    <br>
    <em>TillÃ¤gnad Filosoficirkeln</em>
  </div>
  <button onclick="startGame()">STARTA UPPDRAGET</button>
</div>

<div id="game-over">
  <h1 id="go-title">UPPDRAG SLUTFÃ–RT</h1>
  <div class="score" id="go-score"></div>
  <div style="color:#aaa;margin-bottom:20px" id="go-msg"></div>
  <button onclick="startGame()">NYTT UPPDRAG</button>
</div>

<div id="ui">
  <span id="score-display">POÃ„NG: 0</span> |
  <span id="hits-display">TRÃ„FFAR: 0</span> |
  <span id="hp-display">HP: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ</span>
</div>
<canvas id="game" width="600" height="500"></canvas>

<div class="mobile-controls">
  <div class="dpad">
    <div></div>
    <button ontouchstart="mobileKey('w',true)" ontouchend="mobileKey('w',false)">â–²</button>
    <div></div>
    <button ontouchstart="mobileKey('a',true)" ontouchend="mobileKey('a',false)">â—„</button>
    <div></div>
    <button ontouchstart="mobileKey('d',true)" ontouchend="mobileKey('d',false)">â–º</button>
    <div></div>
    <button ontouchstart="mobileKey('s',true)" ontouchend="mobileKey('s',false)">â–¼</button>
    <div></div>
  </div>
  <button class="fire-btn" ontouchstart="mobileKey(' ',true)" ontouchend="mobileKey(' ',false)">SKJUT</button>
</div>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const W = canvas.width, H = canvas.height;

// Game state
let drone, putin, bullets, missiles, explosions, particles;
let score, hits, gameRunning, keys, lastShot, difficulty;
let droneHP, frame;

const DRONE_SIZE = 32;
const PUTIN_SIZE = 28;
const BULLET_SPEED = 7;
const MISSILE_SPEED = 3;

function mobileKey(key, down) {
  keys[key] = down;
}

function startGame() {
  document.getElementById('start-screen').style.display = 'none';
  document.getElementById('game-over').style.display = 'none';

  drone = { x: W/2, y: H - 60, speed: 4 };
  putin = { x: W/2, y: 80, vx: 2, vy: 1, hitTimer: 0, fleeing: false };
  bullets = [];
  missiles = [];
  explosions = [];
  particles = [];
  score = 0;
  hits = 0;
  droneHP = 100;
  gameRunning = true;
  keys = {};
  lastShot = 0;
  difficulty = 1;
  frame = 0;

  requestAnimationFrame(gameLoop);
}

// Input
document.addEventListener('keydown', e => {
  keys[e.key.toLowerCase()] = true;
  if (e.key === ' ') e.preventDefault();
});
document.addEventListener('keyup', e => {
  keys[e.key.toLowerCase()] = false;
});

function drawPixelRect(x, y, w, h, color) {
  ctx.fillStyle = color;
  ctx.fillRect(Math.round(x), Math.round(y), w, h);
}

function drawDrone(x, y) {
  // Body - blue/yellow Ukrainian colors
  drawPixelRect(x-12, y-4, 24, 10, '#005bbb');
  drawPixelRect(x-16, y-2, 32, 6, '#005bbb');
  // Wings
  drawPixelRect(x-20, y-1, 8, 4, '#333');
  drawPixelRect(x+12, y-1, 8, 4, '#333');
  // Propellers (animated)
  if (frame % 4 < 2) {
    drawPixelRect(x-22, y-3, 6, 2, '#666');
    drawPixelRect(x+16, y-3, 6, 2, '#666');
  } else {
    drawPixelRect(x-20, y-4, 4, 2, '#666');
    drawPixelRect(x+18, y-4, 4, 2, '#666');
  }
  // Yellow stripe
  drawPixelRect(x-10, y+2, 20, 3, '#ffd700');
  // "Big C" label
  ctx.fillStyle = '#ffd700';
  ctx.font = 'bold 8px Courier New';
  ctx.textAlign = 'center';
  ctx.fillText('BIG C', x, y + 12);
  // Gun barrel
  drawPixelRect(x-1, y-8, 3, 5, '#888');
}

function drawPutin(x, y, hitTimer) {
  const flash = hitTimer > 0 && hitTimer % 6 < 3;
  const skinColor = flash ? '#ff4444' : '#f4c99a';
  const suitColor = flash ? '#ff6666' : '#222';

  // Head
  drawPixelRect(x-6, y-14, 12, 12, skinColor);
  // Hair (balding)
  drawPixelRect(x-4, y-15, 8, 2, '#8B7355');
  drawPixelRect(x-6, y-13, 2, 4, '#8B7355');
  drawPixelRect(x+4, y-13, 2, 4, '#8B7355');
  // Eyes (beady)
  drawPixelRect(x-4, y-10, 2, 2, '#000');
  drawPixelRect(x+2, y-10, 2, 2, '#000');
  // Mouth (frown)
  drawPixelRect(x-3, y-5, 6, 1, '#8B4513');
  // Suit body
  drawPixelRect(x-8, y-2, 16, 16, suitColor);
  // Tie (red)
  drawPixelRect(x-1, y-2, 3, 10, '#cc0000');
  // Arms
  drawPixelRect(x-11, y-1, 4, 12, suitColor);
  drawPixelRect(x+7, y-1, 4, 12, suitColor);
  // Legs
  drawPixelRect(x-6, y+14, 5, 6, '#333');
  drawPixelRect(x+1, y+14, 5, 6, '#333');
  // Shoes
  drawPixelRect(x-7, y+18, 6, 3, '#111');
  drawPixelRect(x+1, y+18, 6, 3, '#111');

  // Running animation
  if (frame % 8 < 4) {
    drawPixelRect(x-8, y+14, 5, 6, '#333');
    drawPixelRect(x+3, y+16, 5, 4, '#333');
  }

  // Scared expression when drone is close
  const dist = Math.hypot(drone.x - x, drone.y - y);
  if (dist < 120) {
    // Sweat drops
    ctx.fillStyle = '#88ccff';
    drawPixelRect(x+7, y-12, 2, 3, '#88ccff');
    drawPixelRect(x+8, y-8, 2, 2, '#88ccff');
    // Open mouth (scared)
    drawPixelRect(x-2, y-6, 4, 3, '#000');
  }
}

function drawExplosion(ex) {
  const colors = ['#ff4400', '#ff8800', '#ffcc00', '#ffffff'];
  const r = ex.radius;
  for (let i = 0; i < 8; i++) {
    const angle = (Math.PI * 2 / 8) * i + ex.frame * 0.3;
    const dist = r * (0.5 + Math.random() * 0.5);
    const px = ex.x + Math.cos(angle) * dist;
    const py = ex.y + Math.sin(angle) * dist;
    const size = 3 + Math.random() * 4;
    drawPixelRect(px, py, size, size, colors[Math.floor(Math.random() * colors.length)]);
  }
}

function drawMissile(m) {
  // Red missile body
  drawPixelRect(m.x-2, m.y-4, 4, 8, '#cc0000');
  drawPixelRect(m.x-3, m.y+2, 6, 3, '#880000');
  // Flame trail
  if (frame % 4 < 2) {
    drawPixelRect(m.x-1, m.y+5, 2, 4, '#ff8800');
    drawPixelRect(m.x, m.y+8, 1, 2, '#ffcc00');
  }
}

function spawnMissile() {
  const side = Math.random();
  let mx, my, mvx, mvy;
  if (side < 0.25) { mx = 0; my = Math.random()*H; }
  else if (side < 0.5) { mx = W; my = Math.random()*H; }
  else if (side < 0.75) { mx = Math.random()*W; my = 0; }
  else { mx = Math.random()*W; my = H; }

  const angle = Math.atan2(drone.y - my, drone.x - mx);
  mvx = Math.cos(angle) * (MISSILE_SPEED + difficulty * 0.3);
  mvy = Math.sin(angle) * (MISSILE_SPEED + difficulty * 0.3);

  missiles.push({ x: mx, y: my, vx: mvx, vy: mvy });
}

function addParticles(x, y, color, count) {
  for (let i = 0; i < count; i++) {
    particles.push({
      x, y,
      vx: (Math.random() - 0.5) * 6,
      vy: (Math.random() - 0.5) * 6,
      life: 20 + Math.random() * 20,
      color
    });
  }
}

function update() {
  frame++;

  // Difficulty ramp
  difficulty = 1 + score / 500;

  // Move drone
  const spd = drone.speed;
  if (keys['w'] || keys['arrowup']) drone.y -= spd;
  if (keys['s'] || keys['arrowdown']) drone.y += spd;
  if (keys['a'] || keys['arrowleft']) drone.x -= spd;
  if (keys['d'] || keys['arrowright']) drone.x += spd;
  drone.x = Math.max(20, Math.min(W-20, drone.x));
  drone.y = Math.max(20, Math.min(H-20, drone.y));

  // Shoot
  if (keys[' '] && frame - lastShot > 12) {
    bullets.push({ x: drone.x, y: drone.y - 10, vy: -BULLET_SPEED });
    lastShot = frame;
    addParticles(drone.x, drone.y - 10, '#ffd700', 3);
  }

  // Move Putin (AI)
  if (putin.hitTimer > 0) {
    putin.hitTimer--;
  }

  // Putin runs away from drone
  const dx = drone.x - putin.x;
  const dy = drone.y - putin.y;
  const dist = Math.hypot(dx, dy);

  const fleeSpeed = 2 + difficulty * 0.4;
  if (dist < 150) {
    // Flee from drone
    putin.vx = (-dx / dist) * fleeSpeed;
    putin.vy = (-dy / dist) * fleeSpeed;
    putin.fleeing = true;
  } else {
    // Random wandering
    if (frame % 60 === 0) {
      putin.vx = (Math.random() - 0.5) * 3;
      putin.vy = (Math.random() - 0.5) * 3;
    }
    putin.fleeing = false;
  }

  putin.x += putin.vx;
  putin.y += putin.vy;

  // Keep Putin in bounds (with bounce)
  if (putin.x < 20) { putin.x = 20; putin.vx = Math.abs(putin.vx); }
  if (putin.x > W-20) { putin.x = W-20; putin.vx = -Math.abs(putin.vx); }
  if (putin.y < 20) { putin.y = 20; putin.vy = Math.abs(putin.vy); }
  if (putin.y > H-40) { putin.y = H-40; putin.vy = -Math.abs(putin.vy); }

  // Move bullets
  bullets = bullets.filter(b => {
    b.y += b.vy;
    return b.y > -10;
  });

  // Bullet-Putin collision
  bullets = bullets.filter(b => {
    if (Math.abs(b.x - putin.x) < 14 && Math.abs(b.y - putin.y) < 16) {
      score += 100;
      hits++;
      putin.hitTimer = 20;
      explosions.push({ x: putin.x, y: putin.y, frame: 0, radius: 20 });
      addParticles(putin.x, putin.y, '#ff4400', 8);
      addParticles(putin.x, putin.y, '#ffd700', 4);
      // Teleport Putin to random position after hit
      putin.x = Math.random() * (W - 80) + 40;
      putin.y = Math.random() * (H/2 - 40) + 40;
      return false;
    }
    return true;
  });

  // Spawn missiles (more frequent with difficulty)
  if (frame % Math.max(40, 120 - Math.floor(difficulty * 15)) === 0) {
    spawnMissile();
  }

  // Move missiles (home slightly toward drone)
  missiles = missiles.filter(m => {
    const angle = Math.atan2(drone.y - m.y, drone.x - m.x);
    m.vx += Math.cos(angle) * 0.05;
    m.vy += Math.sin(angle) * 0.05;
    const spd = Math.hypot(m.vx, m.vy);
    const maxSpd = MISSILE_SPEED + difficulty * 0.5;
    if (spd > maxSpd) { m.vx *= maxSpd/spd; m.vy *= maxSpd/spd; }
    m.x += m.vx;
    m.y += m.vy;

    // Missile-drone collision
    if (Math.abs(m.x - drone.x) < 14 && Math.abs(m.y - drone.y) < 10) {
      droneHP -= 20;
      explosions.push({ x: drone.x, y: drone.y, frame: 0, radius: 25 });
      addParticles(drone.x, drone.y, '#ff4400', 12);
      return false;
    }

    // Off screen
    return m.x > -20 && m.x < W+20 && m.y > -20 && m.y < H+20;
  });

  // Update explosions
  explosions = explosions.filter(e => {
    e.frame++;
    e.radius += 2;
    return e.frame < 15;
  });

  // Update particles
  particles = particles.filter(p => {
    p.x += p.vx;
    p.y += p.vy;
    p.life--;
    p.vy += 0.1; // gravity
    return p.life > 0;
  });

  // Check game over
  if (droneHP <= 0) {
    gameRunning = false;
    showGameOver();
  }
}

function draw() {
  // Sky gradient (dark blue)
  ctx.fillStyle = '#0a0a2a';
  ctx.fillRect(0, 0, W, H);

  // Stars
  ctx.fillStyle = '#ffffff';
  for (let i = 0; i < 30; i++) {
    const sx = (i * 137 + frame * 0.1) % W;
    const sy = (i * 97) % H;
    ctx.fillRect(sx, sy, 1, 1);
  }

  // Ground
  ctx.fillStyle = '#1a3a1a';
  ctx.fillRect(0, H-30, W, 30);
  // Ground details
  for (let i = 0; i < W; i += 8) {
    ctx.fillStyle = i % 16 === 0 ? '#2a4a2a' : '#1a3a1a';
    ctx.fillRect(i, H-30, 8, 2);
  }

  // Draw Putin
  drawPutin(putin.x, putin.y, putin.hitTimer);

  // Draw drone
  drawDrone(drone.x, drone.y);

  // Draw bullets
  ctx.fillStyle = '#ffd700';
  bullets.forEach(b => {
    drawPixelRect(b.x-1, b.y-3, 3, 6, '#ffd700');
    drawPixelRect(b.x, b.y-5, 1, 3, '#ffffff');
  });

  // Draw missiles
  missiles.forEach(drawMissile);

  // Draw explosions
  explosions.forEach(drawExplosion);

  // Draw particles
  particles.forEach(p => {
    const alpha = p.life / 40;
    ctx.globalAlpha = alpha;
    drawPixelRect(p.x, p.y, 2, 2, p.color);
  });
  ctx.globalAlpha = 1;

  // HP bar on drone
  const hpW = 24;
  const hpH = 3;
  drawPixelRect(drone.x - hpW/2, drone.y - 18, hpW, hpH, '#333');
  const hpFill = Math.max(0, (droneHP / 100) * hpW);
  const hpColor = droneHP > 60 ? '#00ff00' : droneHP > 30 ? '#ffaa00' : '#ff0000';
  drawPixelRect(drone.x - hpW/2, drone.y - 18, hpFill, hpH, hpColor);

  // Score in corner
  ctx.fillStyle = '#ffd700';
  ctx.font = 'bold 14px Courier New';
  ctx.textAlign = 'left';
  ctx.fillText(`POÃ„NG: ${score}`, 10, 20);
  ctx.fillText(`TRÃ„FFAR: ${hits}`, 10, 36);
  ctx.textAlign = 'right';
  ctx.fillText(`HP: ${droneHP}`, W-10, 20);
  ctx.fillStyle = '#005bbb';
  ctx.font = '10px Courier New';
  ctx.fillText('SLAVA UKRAINI', W-10, 36);
}

function showGameOver() {
  const el = document.getElementById('game-over');
  el.style.display = 'flex';
  document.getElementById('go-score').textContent = `PoÃ¤ng: ${score} | TrÃ¤ffar: ${hits}`;

  let title, msg;
  if (hits === 0) {
    title = 'UPPDRAG MISSLYCKAT';
    msg = 'Putin klarade sig... den hÃ¤r gÃ¥ngen.';
  } else if (hits < 5) {
    title = 'INTE ILLA';
    msg = `${hits} trÃ¤ffar! Putin bÃ¶rjar bli nervÃ¶s.`;
  } else if (hits < 10) {
    title = 'BRA JOBBAT!';
    msg = `${hits} trÃ¤ffar! Putin Ã¶vervÃ¤ger att gÃ¶mma sig i bunkern.`;
  } else if (hits < 20) {
    title = 'EXCELLENT!';
    msg = `${hits} trÃ¤ffar! Putin har redan flytt till bunkern.`;
  } else {
    title = 'LEGENDÃ„R PILOT!';
    msg = `${hits} trÃ¤ffar! Big C har gjort sitt jobb. Cederberg hade varit stolt.`;
  }

  document.getElementById('go-title').textContent = title;
  document.getElementById('go-msg').textContent = msg;
}

function gameLoop() {
  if (!gameRunning) return;
  update();
  draw();

  // Update UI bar
  const hpBar = 'â–ˆ'.repeat(Math.max(0, Math.ceil(droneHP/10)));
  document.getElementById('score-display').textContent = `POÃ„NG: ${score}`;
  document.getElementById('hits-display').textContent = `TRÃ„FFAR: ${hits}`;
  document.getElementById('hp-display').textContent = `HP: ${hpBar}`;

  requestAnimationFrame(gameLoop);
}

// Prevent scrolling on mobile
document.addEventListener('touchmove', e => e.preventDefault(), { passive: false });
</script>
</body>
</html>
